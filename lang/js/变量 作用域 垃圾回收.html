<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>作用域与 | SmacUL&#39;s Blog</title>
    <meta name="description" content="你好">
    <link rel="icon" href="/assets/img/Logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.e8ff0ee6.css" as="style"><link rel="preload" href="/assets/js/app.27d58fa7.js" as="script"><link rel="preload" href="/assets/js/2.f1f09924.js" as="script"><link rel="preload" href="/assets/js/21.82b9d691.js" as="script"><link rel="prefetch" href="/assets/js/10.da04177b.js"><link rel="prefetch" href="/assets/js/11.33537db2.js"><link rel="prefetch" href="/assets/js/12.2c196981.js"><link rel="prefetch" href="/assets/js/13.501a5542.js"><link rel="prefetch" href="/assets/js/14.93a9b12d.js"><link rel="prefetch" href="/assets/js/15.7ddd6566.js"><link rel="prefetch" href="/assets/js/16.32ee58e2.js"><link rel="prefetch" href="/assets/js/17.c415498a.js"><link rel="prefetch" href="/assets/js/18.5ef64d19.js"><link rel="prefetch" href="/assets/js/19.521006c9.js"><link rel="prefetch" href="/assets/js/20.1aa33ed7.js"><link rel="prefetch" href="/assets/js/22.793f9d85.js"><link rel="prefetch" href="/assets/js/23.0ca70d66.js"><link rel="prefetch" href="/assets/js/24.d86f1591.js"><link rel="prefetch" href="/assets/js/25.2ce3a84b.js"><link rel="prefetch" href="/assets/js/26.12cdc3ac.js"><link rel="prefetch" href="/assets/js/27.7b341d36.js"><link rel="prefetch" href="/assets/js/28.61c57439.js"><link rel="prefetch" href="/assets/js/29.90d6873f.js"><link rel="prefetch" href="/assets/js/3.7db0d588.js"><link rel="prefetch" href="/assets/js/30.4f5e13f5.js"><link rel="prefetch" href="/assets/js/31.7ec86adf.js"><link rel="prefetch" href="/assets/js/32.0c179479.js"><link rel="prefetch" href="/assets/js/33.b68ce17c.js"><link rel="prefetch" href="/assets/js/34.6d314a9c.js"><link rel="prefetch" href="/assets/js/35.15ecee78.js"><link rel="prefetch" href="/assets/js/36.d6998519.js"><link rel="prefetch" href="/assets/js/37.e84aeb89.js"><link rel="prefetch" href="/assets/js/38.8bd5bba9.js"><link rel="prefetch" href="/assets/js/39.ffd3bce6.js"><link rel="prefetch" href="/assets/js/4.9b31f553.js"><link rel="prefetch" href="/assets/js/40.1b57eaa8.js"><link rel="prefetch" href="/assets/js/41.ac6f9062.js"><link rel="prefetch" href="/assets/js/42.8854bf5a.js"><link rel="prefetch" href="/assets/js/43.91bf82a7.js"><link rel="prefetch" href="/assets/js/44.c35012af.js"><link rel="prefetch" href="/assets/js/45.07b8e581.js"><link rel="prefetch" href="/assets/js/46.02916103.js"><link rel="prefetch" href="/assets/js/47.f1be0d43.js"><link rel="prefetch" href="/assets/js/48.7f7c7f55.js"><link rel="prefetch" href="/assets/js/49.6692487b.js"><link rel="prefetch" href="/assets/js/5.23b29502.js"><link rel="prefetch" href="/assets/js/50.6c2f6d29.js"><link rel="prefetch" href="/assets/js/51.f7be7c31.js"><link rel="prefetch" href="/assets/js/52.b9dad83f.js"><link rel="prefetch" href="/assets/js/53.8f778f89.js"><link rel="prefetch" href="/assets/js/54.9853cbd5.js"><link rel="prefetch" href="/assets/js/55.f1dfad52.js"><link rel="prefetch" href="/assets/js/56.a89162ce.js"><link rel="prefetch" href="/assets/js/57.b1f1111f.js"><link rel="prefetch" href="/assets/js/58.08f753ab.js"><link rel="prefetch" href="/assets/js/59.e2ff4e09.js"><link rel="prefetch" href="/assets/js/6.ca86ed4c.js"><link rel="prefetch" href="/assets/js/60.14c1ce69.js"><link rel="prefetch" href="/assets/js/61.06a9c523.js"><link rel="prefetch" href="/assets/js/62.af6d0bf2.js"><link rel="prefetch" href="/assets/js/63.47139735.js"><link rel="prefetch" href="/assets/js/64.1b3689b6.js"><link rel="prefetch" href="/assets/js/65.c599d8e8.js"><link rel="prefetch" href="/assets/js/66.91648506.js"><link rel="prefetch" href="/assets/js/67.ecf7742c.js"><link rel="prefetch" href="/assets/js/68.b8769d15.js"><link rel="prefetch" href="/assets/js/69.e055ff05.js"><link rel="prefetch" href="/assets/js/7.9d170f74.js"><link rel="prefetch" href="/assets/js/70.065d9e72.js"><link rel="prefetch" href="/assets/js/71.840612b5.js"><link rel="prefetch" href="/assets/js/72.2a605e0c.js"><link rel="prefetch" href="/assets/js/73.3e54fae5.js"><link rel="prefetch" href="/assets/js/74.8e626e7b.js"><link rel="prefetch" href="/assets/js/75.c64b57c0.js"><link rel="prefetch" href="/assets/js/76.0e7007be.js"><link rel="prefetch" href="/assets/js/77.c8b770b0.js"><link rel="prefetch" href="/assets/js/78.d7da3c62.js"><link rel="prefetch" href="/assets/js/79.a78c6d63.js"><link rel="prefetch" href="/assets/js/8.3616387d.js"><link rel="prefetch" href="/assets/js/80.dda2cb25.js"><link rel="prefetch" href="/assets/js/81.2f232306.js"><link rel="prefetch" href="/assets/js/82.df6bca63.js"><link rel="prefetch" href="/assets/js/83.6251af59.js"><link rel="prefetch" href="/assets/js/84.d3eda27f.js"><link rel="prefetch" href="/assets/js/85.71180abd.js"><link rel="prefetch" href="/assets/js/86.3c5a5f86.js"><link rel="prefetch" href="/assets/js/87.12474af5.js"><link rel="prefetch" href="/assets/js/9.c04fa05e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e8ff0ee6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">SmacUL's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/self/" class="nav-link">关于我</a></div><div class="nav-item"><a href="https://github.com/SmacUL" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/self/" class="nav-link">关于我</a></div><div class="nav-item"><a href="https://github.com/SmacUL" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/lang/js/" class="sidebar-link">JS 笔记</a></li><li><a href="/lang/js/数据类型.html" class="sidebar-link">数据类型</a></li><li><a href="/lang/js/变量 作用域 垃圾回收.html" class="active sidebar-link">作用域</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lang/js/变量 作用域 垃圾回收.html#作用域的相关概念" class="sidebar-link">作用域的相关概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lang/js/变量 作用域 垃圾回收.html#总览" class="sidebar-link">总览</a></li><li class="sidebar-sub-header"><a href="/lang/js/变量 作用域 垃圾回收.html#执行环境-作用域" class="sidebar-link">执行环境 / 作用域</a></li><li class="sidebar-sub-header"><a href="/lang/js/变量 作用域 垃圾回收.html#变量对象" class="sidebar-link">变量对象</a></li><li class="sidebar-sub-header"><a href="/lang/js/变量 作用域 垃圾回收.html#活动对象" class="sidebar-link">活动对象</a></li><li class="sidebar-sub-header"><a href="/lang/js/变量 作用域 垃圾回收.html#作用域栈" class="sidebar-link">作用域栈</a></li><li class="sidebar-sub-header"><a href="/lang/js/变量 作用域 垃圾回收.html#作用域链" class="sidebar-link">作用域链</a></li></ul></li><li class="sidebar-sub-header"><a href="/lang/js/变量 作用域 垃圾回收.html#块级作用域" class="sidebar-link">块级作用域</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lang/js/变量 作用域 垃圾回收.html#js-仿造块级作用域" class="sidebar-link">JS 仿造块级作用域</a></li><li class="sidebar-sub-header"><a href="/lang/js/变量 作用域 垃圾回收.html#es6-的块级作用域" class="sidebar-link">ES6 的块级作用域</a></li></ul></li></ul></li><li><a href="/lang/js/垃圾回收.html" class="sidebar-link">垃圾回收</a></li><li><a href="/lang/js/闭包.html" class="sidebar-link">闭包</a></li><li><a href="/lang/js/事件流 事件处理程序 事件对象.html" class="sidebar-link">事件</a></li><li><a href="/lang/js/Ajax 与 Conet.html" class="sidebar-link">Ajax 与 Conet</a></li><li><a href="/lang/js/常用场景.html" class="sidebar-link">常用场景</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="作用域与"><a href="#作用域与" class="header-anchor">#</a> 作用域与</h1> <p>这一部分会说明作用域相关的基本概念, 然后牵出一个 JS 中非常重要的概念<strong>作用域链</strong>, 并且简单描述一下 ES6 中的<strong>块级作用域</strong>.</p> <div class="custom-block warning"><p class="custom-block-title">警告</p> <p>关于 JS 的执行环境和作用域, 我认为他们就是一个东西, 反正我没看出什么区别, 底下的内容可能存在执行环境和作用域混用的情况, 知道是一个东西就行.</p></div> <h2 id="作用域的相关概念"><a href="#作用域的相关概念" class="header-anchor">#</a> 作用域的相关概念</h2> <h3 id="总览"><a href="#总览" class="header-anchor">#</a> 总览</h3> <p>不像其他的编程语言使用 <code>{}</code> 来限制作用域, JS 中的作用域有两类: <strong>全局作用域</strong>和<strong>函数作用域</strong>. 在 JS 中, 每个作用域中都可能有大量的属性(变量)和一些子作用域(函数作用域), 那么就需要一个专门的对象来保存这些数据, 这在 JS 中被定义为<strong>变量对象</strong>.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>用函数来标识作用域, emmmmmm . 后面会出现很多与之相关的非常诡异的现象.</p></div> <p>现在我们保存了数据, 但是还不够. 如果我们的执行流从上级作用域 A 切换到下级作用域 B 中, 总有一天, 我们要离开 B , 那么我们如何让解释器想起来 B 的上一级作用域是 A ?</p> <p>必然的, 我们需要一个什么东西来管理这些执行环境, 在操作系统中, 这种事情常常交给队列或栈来实现. 在 JS 中也可以使用栈的概念, 定义为<strong>作用域栈</strong>, 作用域栈的顶部当前执行流所在的作用域, 当执行流离开此作用域时, 这个作用域就会被弹出.</p> <p>这里, <strong>作用域链</strong>, 在我的理解, 就是一种对作用域栈的具体实现. 作用域栈的每个节点保存的是作用域; 相应的, 作用域链中的每个节点保存的是变量对象的引用.</p> <p>有些时候, 我们可能还会看到<strong>活动对象</strong>的概念, 活动对象就是作用域链上正在被执行和引用的变量对象, 其实是同一个东西在不同时刻的叫法.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>执行环境, 变量对象, 活动对象, 作用域链都是在 JS 代码执行过程中出现变化的.</p></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>关于活动对象的描述可能和 <code>JS 高级程序设计</code> 书中的描述不太一致, 我个人认为, 书的作者或者译者在这个地方串用了活动对象和变量对象. 笔记中采用的说法是网络说法, 我觉得比较有道理, 故使用此说法.</p></div> <p>到这个位置, 和作用域的相关的基本概念就处理完了, 下面算是小结吧.</p> <h3 id="执行环境-作用域"><a href="#执行环境-作用域" class="header-anchor">#</a> 执行环境 / 作用域</h3> <p>执行环境规定了变量 / 对象能够访问其他数据的范围. 一切的一切从全局执行环境开始. 每个函数都会有自己的执行环境.</p> <h3 id="变量对象"><a href="#变量对象" class="header-anchor">#</a> 变量对象</h3> <p>变量对象储存了执行执行环境中包含的变量和函数, 每个执行环境都会有一个自己的变量对象.</p> <h3 id="活动对象"><a href="#活动对象" class="header-anchor">#</a> 活动对象</h3> <p>本质上也是变量对象, 但是为了表达代码运行的动态性, 提出了活动对象的概念. 当有某个变量对象变成活动对象时, 这意味代码就执行到这个变量对象对应的作用域.</p> <h3 id="作用域栈"><a href="#作用域栈" class="header-anchor">#</a> 作用域栈</h3> <p>保证执行环境中的所有变量和函数都能够被有序访问. 和上面的说的一样, 我更倾向于他是一个高级抽象概念, 用于解释作用域链的.</p> <h3 id="作用域链"><a href="#作用域链" class="header-anchor">#</a> 作用域链</h3> <p>保证执行环境中的所有变量和函数都能够被有序访问. 作用域链中包含着许多变量对象的引用, 在作用域链活跃的一头, 就是活动对象的引用.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>每个作用域在被执行的时候, 都会拥有自己的作用域链, 大家的作用域链可能会有一些不同, 或长或短.</p></div> <h4 id="父子作用域的访问限制"><a href="#父子作用域的访问限制" class="header-anchor">#</a> 父子作用域的访问限制</h4> <p>父环境无法通过作用域链向下(由父到子)访问到子环境中的变量;<br>
子环境可以通过作用域链向上(由子到父)访问到父环境中的变量;</p> <h4 id="作用域链中变量的查询-变量提升的问题"><a href="#作用域链中变量的查询-变量提升的问题" class="header-anchor">#</a> 作用域链中变量的查询 (变量提升的问题)</h4> <p>如果作用域链中存在多个同名的局部变量, JS 在使用 此变量名的变量 时就会启动变量查询机制, 这个机制将会从当前的执行环境开始, 沿着作用域链向上查找最近的声明了的同名变量.</p> <div class="language-JS line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行 test , console 将打印出 undefinded . </span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>上面的例子, 就说明了这点. 直觉上我们可能会觉得应该打印 1 , 但是 <code>test</code> 函数的作用域的变量对象包含了一个 <code>a</code> 变量. 所以变量名的查询机制不会翻看 1 行的变量 <code>a</code>.</p> <p>然而, JS 解释器按照顺序执行, 看到 3 行要打印的内容并没有被赋值, 于是 undefinded 和一个大写的 NAIVE 就出现在了浏览器屏幕上.</p> <p>这种情况被称为<strong>变量提升</strong>, 即变量可以在声明前使用的情况.</p> <h2 id="块级作用域"><a href="#块级作用域" class="header-anchor">#</a> 块级作用域</h2> <p>之前说过, 早版本的 JS 中 <code>{}</code> 不具备对作用域的限制功能, 但是 ES6 就和大多数编程语言一样, 支持 <code>{}</code> 的作用域. 由于没有块级作用域, 很容易出现上面提到的变量提升和 for 循环中循环索引泄露的问题.</p> <p>那么这里就会有两个主题, 一个是如何使用 JS 仿造块级作用域, 二是简单 BB 一下 ES6 中的块级作用域.</p> <h3 id="js-仿造块级作用域"><a href="#js-仿造块级作用域" class="header-anchor">#</a> JS 仿造块级作用域</h3> <p>在没有块级作用域的年代, 一种特殊的写法, 叫 匿名立即执行函数表达式 ,</p> <div class="language-JS line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-js"><code><span class="token comment">// 如果我们这样写 for 循环, 5 行的 log 是能够打印出数值 10 的 (最后 i 被 ++ 了)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10</span>

<span class="token comment">// 如果我们使用 匿名立即执行函数表达式 , 13 行的 log 将报错</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Can't find variable: i</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>一个比较特殊的地方就是 12 行高亮位置的 <code>()</code> , 它允许当前这个匿名函数立即执行, 从而达到伪块级作用域的效果</p> <h3 id="es6-的块级作用域"><a href="#es6-的块级作用域" class="header-anchor">#</a> <a href="http://es6.ruanyifeng.com/#docs/let#%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F" target="_blank" rel="noopener noreferrer">ES6 的块级作用域<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>先看一下 ES6 中提到的 <code>var</code> 和 <code>let</code> . ES6 中块级作用域的基础内容从直觉上看和其他的编程语言没有太大的差别.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>当 ES6 的解释器遇到 <code>let</code> 和  <code>const</code> 两个关键字声明的变量 / 常量时, 仍然会和遇到 <code>var</code> 一样, 先将变量 / 常量提升到块级作用域的开头. 只不过, <code>var</code> 允许 变量使用代码 在 变量声明代码 之前, 而 <code>let</code> 和  <code>const</code> 在遇到 变量使用代码 在 变量声明代码 之前的情况会报错.</p></div> <h4 id="循环索引"><a href="#循环索引" class="header-anchor">#</a> 循环索引</h4> <p>循环中声明的循环索引算哪一部分的块级作用域.</p> <p>我们可以做出三种假设:</p> <ol><li>属于 for 循环所在的 &quot;高级&quot; 的作用域</li> <li>属于 for 循环 <code>{}</code> 内的作用域</li> <li>自成一家</li></ol> <p>针对假设编写代码, 如果 1 和 2 的假设不成立, 则可以认为 3 成立.</p> <div class="language-JS line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-js"><code><span class="token comment">// 第 1 种假设的代码</span>
<span class="token keyword">let</span> i<span class="token operator">=</span> <span class="token number">22</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这里将打印 0 到 9</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>第一段代码正常运行, 说明循环索引 i 和全局下的 i 并不矛盾, 假设 1 不成立.</p> <div class="language-JS line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code><span class="token comment">// 第 2 种假设的代码</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这里将打印 10 个 12 </span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>第二段代码也是正常运行, 说明循环索引 i 和 for 循环块级作用域中的 i 并不矛盾, 假设 2 不成立.</p> <p>上面的两段代码的实验结果更加倾向于第 3 种假设, 即循环中声明的循环索引自成一家.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>两段代码不要同时运行.</p></div> <h4 id="块级作用域与函数声明"><a href="#块级作用域与函数声明" class="header-anchor">#</a> 块级作用域与函数声明</h4> <p>函数能否在块级作用域中被声明, 由于历史原因, 这个问题变得非常的复杂. 非常有意思的一点, 这里 ES 想做出一些规范, 但是浏览器总是有一些自己的想法.</p> <p>ES5 规定, 函数只能在顶层作用域和函数作用域之中声明, 不能在块级作用域声明. 但是浏览器没有遵守这个规定, 为了兼容以前的旧代码, 还是支持在块级作用域之中声明函数,</p> <p>ES6 规定, 明确允许在块级作用域之中声明函数. 同时在块级作用域之中, 函数声明语句的行为类似于 let , 在块级作用域之外不可引用; 但是 ES6 在附录 B 里面规定, 浏览器的实现可以不遵守上面的规定. 函数声明将类似于 var .</p> <p>总结来说, 最大的坑是在块级作用域中使用函数声明式的写法, 可能不同浏览器在不同环境下的行为都不太一致, 标准在这个地方就和虚设的一样.</p> <h4 id="在块级作用域中编写函数的建议"><a href="#在块级作用域中编写函数的建议" class="header-anchor">#</a> 在块级作用域中编写函数的建议</h4> <p>努力避免在块级作用域中使用函数声明式的写法, 应该使用函数表达式.</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/23/2019, 7:43:35 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/lang/js/数据类型.html" class="prev">数据类型</a></span> <span class="next"><a href="/lang/js/垃圾回收.html">垃圾回收</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.27d58fa7.js" defer></script><script src="/assets/js/2.f1f09924.js" defer></script><script src="/assets/js/21.82b9d691.js" defer></script>
  </body>
</html>
