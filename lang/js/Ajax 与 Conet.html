<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ajax 与 Conet | SmacUL&#39;s Blog</title>
    <meta name="description" content="你好">
    <link rel="icon" href="/assets/img/Logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.9c3f924d.css" as="style"><link rel="preload" href="/assets/js/app.56eb9740.js" as="script"><link rel="preload" href="/assets/js/2.f1f09924.js" as="script"><link rel="preload" href="/assets/js/12.4625b8d2.js" as="script"><link rel="prefetch" href="/assets/js/10.a706685c.js"><link rel="prefetch" href="/assets/js/11.743677f0.js"><link rel="prefetch" href="/assets/js/13.20e401c7.js"><link rel="prefetch" href="/assets/js/14.153521b1.js"><link rel="prefetch" href="/assets/js/15.32ddf537.js"><link rel="prefetch" href="/assets/js/16.8707e308.js"><link rel="prefetch" href="/assets/js/17.d60a894c.js"><link rel="prefetch" href="/assets/js/18.6860fd78.js"><link rel="prefetch" href="/assets/js/19.cc777474.js"><link rel="prefetch" href="/assets/js/20.0806bc83.js"><link rel="prefetch" href="/assets/js/21.a28254eb.js"><link rel="prefetch" href="/assets/js/22.3df70647.js"><link rel="prefetch" href="/assets/js/23.95141a80.js"><link rel="prefetch" href="/assets/js/24.749c63bc.js"><link rel="prefetch" href="/assets/js/25.0312ed2b.js"><link rel="prefetch" href="/assets/js/26.1bddc38c.js"><link rel="prefetch" href="/assets/js/27.ddec5ece.js"><link rel="prefetch" href="/assets/js/28.a88314e7.js"><link rel="prefetch" href="/assets/js/29.f8b857a3.js"><link rel="prefetch" href="/assets/js/3.2f317a91.js"><link rel="prefetch" href="/assets/js/30.834d8890.js"><link rel="prefetch" href="/assets/js/31.b6daea79.js"><link rel="prefetch" href="/assets/js/32.e3de8f14.js"><link rel="prefetch" href="/assets/js/33.8e0f1d38.js"><link rel="prefetch" href="/assets/js/34.b40cc1e0.js"><link rel="prefetch" href="/assets/js/35.69ddf520.js"><link rel="prefetch" href="/assets/js/36.7989110d.js"><link rel="prefetch" href="/assets/js/37.3ba480cb.js"><link rel="prefetch" href="/assets/js/38.ad318699.js"><link rel="prefetch" href="/assets/js/39.82666b88.js"><link rel="prefetch" href="/assets/js/4.9b31f553.js"><link rel="prefetch" href="/assets/js/40.69276d69.js"><link rel="prefetch" href="/assets/js/41.accb11b1.js"><link rel="prefetch" href="/assets/js/42.759d1c80.js"><link rel="prefetch" href="/assets/js/43.8605f6ca.js"><link rel="prefetch" href="/assets/js/44.0dd6f4e9.js"><link rel="prefetch" href="/assets/js/45.3e322946.js"><link rel="prefetch" href="/assets/js/46.2afde74c.js"><link rel="prefetch" href="/assets/js/47.adb2d2fe.js"><link rel="prefetch" href="/assets/js/48.88ae9d9d.js"><link rel="prefetch" href="/assets/js/49.fb25a6db.js"><link rel="prefetch" href="/assets/js/5.f8e87f20.js"><link rel="prefetch" href="/assets/js/50.7bb0af03.js"><link rel="prefetch" href="/assets/js/51.98801d64.js"><link rel="prefetch" href="/assets/js/52.7ade034b.js"><link rel="prefetch" href="/assets/js/53.a5f65923.js"><link rel="prefetch" href="/assets/js/54.e979d976.js"><link rel="prefetch" href="/assets/js/55.3d0d7c46.js"><link rel="prefetch" href="/assets/js/6.c6a75bfe.js"><link rel="prefetch" href="/assets/js/7.e0345d7a.js"><link rel="prefetch" href="/assets/js/8.27a5599c.js"><link rel="prefetch" href="/assets/js/9.a0d9b307.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9c3f924d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">SmacUL's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/self/" class="nav-link">About Me</a></div><div class="nav-item"><a href="https://github.com/SmacUL" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/self/" class="nav-link">About Me</a></div><div class="nav-item"><a href="https://github.com/SmacUL" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/lang/js/" class="sidebar-link">JS 笔记</a></li><li><a href="/lang/js/数据类型.html" class="sidebar-link">数据类型</a></li><li><a href="/lang/js/变量 作用域 垃圾回收.html" class="sidebar-link">作用域</a></li><li><a href="/lang/js/垃圾回收.html" class="sidebar-link">垃圾回收</a></li><li><a href="/lang/js/闭包.html" class="sidebar-link">闭包</a></li><li><a href="/lang/js/事件流 事件处理程序 事件对象.html" class="sidebar-link">事件</a></li><li><a href="/lang/js/Ajax 与 Conet.html" class="active sidebar-link">Ajax 与 Conet</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#xmlhttprequest-对象-xhr" class="sidebar-link">XMLHttpRequest 对象 (XHR)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#xhr-的基本用法" class="sidebar-link">XHR 的基本用法</a></li><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#xhr-的返回数据处理-同步" class="sidebar-link">XHR 的返回数据处理(同步)</a></li><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#xhr-的返回数据处理-异步" class="sidebar-link">XHR 的返回数据处理(异步)</a></li><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#http-头部信息" class="sidebar-link">HTTP 头部信息</a></li><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#get-请求" class="sidebar-link">GET 请求</a></li><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#post-请求" class="sidebar-link">POST 请求</a></li></ul></li><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#xmlhttprequest-对象-2-级-xhr" class="sidebar-link">XMLHttpRequest 对象 (2 级 XHR)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#formdata-传输数据格式规范" class="sidebar-link">FormData 传输数据格式规范</a></li><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#timeout-超时设定-仅仅-ie" class="sidebar-link">timeout 超时设定 (仅仅 IE)</a></li><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#overridemimetype-方法" class="sidebar-link">overrideMimeType 方法</a></li></ul></li><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#进度事件" class="sidebar-link">进度事件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#load-事件" class="sidebar-link">load 事件</a></li><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#progress-事件" class="sidebar-link">progress 事件</a></li></ul></li><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#跨源资源共享" class="sidebar-link">跨源资源共享</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#ie-对-cors-的实现" class="sidebar-link">IE 对 CORS 的实现</a></li><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#其他浏览器对-cors-的实现" class="sidebar-link">其他浏览器对 CORS 的实现</a></li><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#prefligted-requests" class="sidebar-link">Prefligted Requests</a></li><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#带凭据的请求" class="sidebar-link">带凭据的请求</a></li><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#跨浏览器的-cors" class="sidebar-link">跨浏览器的 CORS</a></li></ul></li><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#其他跨域技术" class="sidebar-link">其他跨域技术</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#图像-ping" class="sidebar-link">图像 Ping</a></li><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#jsonp" class="sidebar-link">JSONP</a></li><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#comet" class="sidebar-link">Comet</a></li><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#服务器发送事件" class="sidebar-link">服务器发送事件</a></li><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#web-sockets" class="sidebar-link">Web Sockets</a></li><li class="sidebar-sub-header"><a href="/lang/js/Ajax 与 Conet.html#sse-和-websockets" class="sidebar-link">SSE 和 WebSockets</a></li></ul></li></ul></li><li><a href="/lang/js/常用场景.html" class="sidebar-link">常用场景</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ajax-与-conet"><a href="#ajax-与-conet" class="header-anchor">#</a> Ajax 与 Conet</h1> <h2 id="xmlhttprequest-对象-xhr"><a href="#xmlhttprequest-对象-xhr" class="header-anchor">#</a> XMLHttpRequest 对象 (XHR)</h2> <p>各个浏览器都支持原生的 XHR 对象;</p> <div class="language-JS line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="xhr-的基本用法"><a href="#xhr-的基本用法" class="header-anchor">#</a> XHR 的基本用法</h3> <ul><li><p><code>xhr.open(请求类型, 请求的 URL , 是否异步)</code>;<br>
URL 相遇对执行代码的当前路径;<br>
open 方法只是准备, 并不会发送请求;<br>
是否异步的参数: true 为异步, false 为同步</p></li> <li><p><code>xhr.send(作为请求主体发送的数据)</code>;<br>
send 方法发送请求;</p></li></ul> <h3 id="xhr-的返回数据处理-同步"><a href="#xhr-的返回数据处理-同步" class="header-anchor">#</a> XHR 的返回数据处理(同步)</h3> <p>接受服务器响应数据:</p> <p>服务器的响应数据会被自动填充到 xhr 的属性中;</p> <p>响应数据一般有:</p> <ul><li>status</li> <li>statusText</li> <li>responseText</li> <li>responseXML</li></ul> <p>响应内容为 text/xml 或者 application/xml</p> <p>这个属性中将保存包含着响应数据的 XML DOM 文档;</p> <p>对响应数据的处理:</p> <ol><li>检查 status 属性, HTTP 的代码;</li></ol> <p><code>xhr.staus &gt;= 200 &amp;&amp; xhr.status &lt; 300 || xhr.status = 304</code></p> <ol><li>访问 XHR 的 <code>responseText</code> 或 <code>responseXML</code></li></ol> <p><code>xhr.responseText / xhr.reponseXML</code></p> <h3 id="xhr-的返回数据处理-异步"><a href="#xhr-的返回数据处理-异步" class="header-anchor">#</a> XHR 的返回数据处理(异步)</h3> <p>XHR 的 readyState 属性标明了 请求-响应 过程的各个活动阶段;</p> <ul><li>0 未初始化<br>
没有调用 open 方法</li> <li>1 启动<br>
调用了 open 方法, 没有调用 send 方法</li> <li>2 发送<br>
调用了open 和 send 方法</li> <li>3 接收<br>
响应数据接收过程</li> <li>4 完成<br>
响应数据接收完毕, 可以在客户端使用</li></ul> <p>只要 <code>readyState</code> 属性的值变化时, 就会触发 <code>readystatechange</code> 事件;</p> <p>在调用 <code>open()</code> 方法之前, 需要设置 <code>readystatechange</code> 的监听器;</p> <p>在访问响应数据前, 检查 <code>readyState</code> 的属性是否为 4 ;</p> <div class="language-JS line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token function">createXHR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">304</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
            <span class="token function">alert</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> 
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Request was unsuccessful: &quot;</span> <span class="token operator">+</span> xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;example.txt&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="http-头部信息"><a href="#http-头部信息" class="header-anchor">#</a> HTTP 头部信息</h3> <h3 id="get-请求"><a href="#get-请求" class="header-anchor">#</a> GET 请求</h3> <h3 id="post-请求"><a href="#post-请求" class="header-anchor">#</a> POST 请求</h3> <p>post 请求会将数据作为请求的主体提交, 这是与 get 请求的一大区别;</p> <p>可以将需要发送给服务器的数据封装之后 交给 send 方法</p> <h2 id="xmlhttprequest-对象-2-级-xhr"><a href="#xmlhttprequest-对象-2-级-xhr" class="header-anchor">#</a> XMLHttpRequest 对象 (2 级 XHR)</h2> <h3 id="formdata-传输数据格式规范"><a href="#formdata-传输数据格式规范" class="header-anchor">#</a> FormData 传输数据格式规范</h3> <p>FormData 用于序列化表单以及创建与表单格式相同的数据;</p> <div class="language-JS line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> form <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;user-info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span>form<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="timeout-超时设定-仅仅-ie"><a href="#timeout-超时设定-仅仅-ie" class="header-anchor">#</a> timeout 超时设定 (仅仅 IE)</h3> <p>timeout 单位是毫秒;</p> <p>xhr 可以在超时之后触发 timeout 事件,</p> <div class="language-JS line-numbers-mode"><pre class="language-js"><code>xhr<span class="token punctuation">.</span>time <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">ontimeout</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;timeout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="overridemimetype-方法"><a href="#overridemimetype-方法" class="header-anchor">#</a> overrideMimeType 方法</h3> <p>MIME 多用途互联网邮件扩展类型;</p> <h2 id="进度事件"><a href="#进度事件" class="header-anchor">#</a> 进度事件</h2> <h3 id="load-事件"><a href="#load-事件" class="header-anchor">#</a> load 事件</h3> <p>一开始 firefox 使用了 load 事件, 在响应数据接收完毕后触发;</p> <p>但是由于历史原因, 只要浏览器接到服务器的响应, 不论状态如何, 都会触发 load 事件;</p> <h3 id="progress-事件"><a href="#progress-事件" class="header-anchor">#</a> progress 事件</h3> <h2 id="跨源资源共享"><a href="#跨源资源共享" class="header-anchor">#</a> 跨源资源共享</h2> <p>跨域的一般用于两个方面:</p> <ul><li>访问远程资源, 而非本地内容;</li> <li>前后端分离的项目, 服务器的域不一致;</li></ul> <h3 id="ie-对-cors-的实现"><a href="#ie-对-cors-的实现" class="header-anchor">#</a> IE 对 CORS 的实现</h3> <p>CORS: Cross-Origin Resouce Sharing 跨源资源共享,</p> <p>定义了在访问跨原资源时, 浏览器与服务器应该如果沟通;</p> <p>核心思想:</p> <p>使用自定义的 HTTP 头部, 让浏览器与服务器进行沟通,</p> <p>从而决定请求或响应是否应该成功;</p> <p>有一个重要的东西: Access-Control-Allow-Origin ?</p> <p>IE 引入了 XDR (XHR 的跨域版本) ;</p> <p>XDR 的使用方法和 XHR 类似, 需要先使用 open 方法, 然后使用 send 方法;</p> <p>使用 XDR 需要注意的地方:</p> <ul><li>XDR 默认是异步通信;</li> <li>XDR 返回的数据只有原始本文, 没有状态代码;</li> <li>只要访问有效, 就会触发 load 事件;</li> <li>如果失败, 就会触发 error 事件,     没有报错信息;</li> <li>load 和 error<br>
事件的处理程序都要自己写, load 是必须的, error 可以不用;</li></ul> <h3 id="其他浏览器对-cors-的实现"><a href="#其他浏览器对-cors-的实现" class="header-anchor">#</a> 其他浏览器对 CORS 的实现</h3> <p>相比 IE , 其他浏览器就聪明的多, 使用标准的 XHR ,</p> <p>并在 open 方法传入绝对 URL 即可;</p> <p>这样的 XHR 可以访问 status 和 statusText 属性, 支持同步请求;</p> <p>跨域 XHR 对象的限制:</p> <ul><li>不能使用 <code>setRequestHeader()</code>     设定自定义头部</li> <li>不能发送和接受 cookie</li> <li>调用     <code>getAllResponseHeaders()</code> 方法总会返回空字符串;</li></ul> <p>建议本地资源使用相对路径, 远程资源使用绝对路径;</p> <h3 id="prefligted-requests"><a href="#prefligted-requests" class="header-anchor">#</a> Prefligted Requests</h3> <p>Prefligted Requests 是 CORS 的高阶使用方法,</p> <p>允许用户:</p> <ul><li>使用自定义的头部;</li> <li>GET 或 POST 以外的方法;</li> <li>发送不同类型的主体内容;</li></ul> <h3 id="带凭据的请求"><a href="#带凭据的请求" class="header-anchor">#</a> 带凭据的请求</h3> <p>凭据: cookie / HTTP 认证 / 客户端 SSL 证明</p> <h3 id="跨浏览器的-cors"><a href="#跨浏览器的-cors" class="header-anchor">#</a> 跨浏览器的 CORS</h3> <h2 id="其他跨域技术"><a href="#其他跨域技术" class="header-anchor">#</a> 其他跨域技术</h2> <h3 id="图像-ping"><a href="#图像-ping" class="header-anchor">#</a> 图像 Ping</h3> <h3 id="jsonp"><a href="#jsonp" class="header-anchor">#</a> JSONP</h3> <p>JSON with padding ,</p> <p>script 标签不受域的限制, 可以随意访问;</p> <p>分成两个部分, 回调函数和响应数据; 回调函数在本地, 响应数据在远程;</p> <p>客户端通过 script 的 src 属性传入访问的 URL 以及本地的回调函数名,</p> <p>服务器收到之后, 会将 response 加载到客户端的回调函数中;</p> <div class="language-JS line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">handleResponse</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;You’re at IP address &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span>ip <span class="token operator">+</span> <span class="token string">&quot;, which is in &quot;</span> <span class="token operator">+</span> 
    response<span class="token punctuation">.</span>city <span class="token operator">+</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> response<span class="token punctuation">.</span>region_name<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
<span class="token keyword">var</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;http://freegeoip.net/json/?callback=handleResponse&quot;</span><span class="token punctuation">;</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>script<span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="comet"><a href="#comet" class="header-anchor">#</a> Comet</h3> <p>Ajax 是一种 从客户端访问服务器的技术,</p> <p>Comet 是一种 服务器向页面推送数据的技术;</p> <p>Comet 的实现方式: 长轮询 和 流</p> <ul><li>短轮询</li></ul> <p>浏览器时不时地向服务器发起请求, 查询是否有新的数据;</p> <ul><li>长轮询</li></ul> <p>浏览器向服务器发起请求, 查询是否有新的数据,</p> <p>如果有新的数据, 服务端才向浏览器发送响应, 完毕后连接关闭,</p> <p>浏览器再重新向服务器发起请求;</p> <ul><li>HTTP 流</li></ul> <p>不同于轮询, 流在页面的整个生命周期内只使用一个 HTTP 连接;</p> <p>浏览器一开始就会向服务器发送一个请求, 而服务器保持连接,</p> <p>同时服务器周期性地向浏览器发送数据;</p> <p>XHR readstatechange 事件 readyState 是否为 3 (客户端开始接受数据)</p> <p>readyState 为 4 时, 打包所有数据;</p> <div class="language-JS line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createStreamingClient</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> progress<span class="token punctuation">,</span> finished</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
	<span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> received <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
	xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
	xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
		<span class="token keyword">var</span> result<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
			<span class="token comment">//只取得最新数据并调整计数器</span>
			result <span class="token operator">=</span> xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>received<span class="token punctuation">)</span><span class="token punctuation">;</span>
			received <span class="token operator">+=</span> result<span class="token punctuation">.</span>length<span class="token punctuation">;</span> 
			<span class="token comment">//调用 progress 回调函数</span>
			<span class="token function">progress</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> 
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
			<span class="token function">finished</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span> 
		<span class="token punctuation">}</span> 
	<span class="token punctuation">}</span><span class="token punctuation">;</span> 
	xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> xhr<span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 

<span class="token keyword">var</span> client <span class="token operator">=</span> <span class="token function">createStreamingClient</span><span class="token punctuation">(</span><span class="token string">&quot;streaming.php&quot;</span><span class="token punctuation">,</span> 
			<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Received: &quot;</span> <span class="token operator">+</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> 
			<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Done!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="服务器发送事件"><a href="#服务器发送事件" class="header-anchor">#</a> 服务器发送事件</h3> <h3 id="web-sockets"><a href="#web-sockets" class="header-anchor">#</a> Web Sockets</h3> <h3 id="sse-和-websockets"><a href="#sse-和-websockets" class="header-anchor">#</a> SSE 和 WebSockets</h3></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/10/2019, 10:02:38 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/lang/js/事件流 事件处理程序 事件对象.html" class="prev">事件</a></span> <span class="next"><a href="/lang/js/常用场景.html">常用场景</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.56eb9740.js" defer></script><script src="/assets/js/2.f1f09924.js" defer></script><script src="/assets/js/12.4625b8d2.js" defer></script>
  </body>
</html>
