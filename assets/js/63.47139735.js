(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{246:function(s,a,e){"use strict";e.r(a);var t=e(0),r=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"minikube-与-kubectl"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#minikube-与-kubectl"}},[s._v("#")]),s._v(" Minikube 与 Kubectl")]),s._v(" "),e("p",[s._v("Minikube 可以用来创建单节点的 Kubernetes 环境, Kubectl 则是一个 Kubernetes 的命令工具.")]),s._v(" "),e("p",[s._v("下面的内容将 BB 如何在国内环境下和虚拟机中安装配置这两个玩意, 以及关于\n它们的常见操作.")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://www.cnblogs.com/cjsblog/p/11877014.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("@狂乱的贵公子-Kubernetes 环境搭建"),e("OutboundLink")],1)]),s._v(" "),e("h2",{attrs:{id:"quick-start"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#quick-start"}},[s._v("#")]),s._v(" Quick Start")]),s._v(" "),e("h3",{attrs:{id:"安装环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装环境"}},[s._v("#")]),s._v(" 安装环境")]),s._v(" "),e("p",[s._v("VMWare CentOS7 虚拟机")]),s._v(" "),e("ul",[e("li",[s._v("最小化安装")]),s._v(" "),e("li",[s._v("CPU 2*2.7GHz")]),s._v(" "),e("li",[s._v("内存 2G")]),s._v(" "),e("li",[s._v("NAT 网络模式")])]),s._v(" "),e("p",[s._v("默认虚拟机中安装好了 Docker.")]),s._v(" "),e("h3",{attrs:{id:"预先的配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#预先的配置"}},[s._v("#")]),s._v(" 预先的配置")]),s._v(" "),e("h4",{attrs:{id:"关闭防火墙"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#关闭防火墙"}},[s._v("#")]),s._v(" 关闭防火墙")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("systemctl stop firewalld\nsystemctl disable firewalld\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h4",{attrs:{id:"关闭-selinux"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#关闭-selinux"}},[s._v("#")]),s._v(" 关闭 Selinux")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("setenforce "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s/^SELINUX=enforcing/SELINUX=disabled/g"')]),s._v(" /etc/selinux/config\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h4",{attrs:{id:"关闭-swap"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#关闭-swap"}},[s._v("#")]),s._v(" 关闭 Swap")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("swapoff -a\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/.*swap.*/#&/'")]),s._v(" /etc/fstab\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"kubectl-的安装配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kubectl-的安装配置"}},[s._v("#")]),s._v(" Kubectl 的安装配置")]),s._v(" "),e("p",[s._v("Kubectl 是一个命令行接口, 用于对 Kubernetes 集群运行命令. 使用 yum 下载安装此工具.")]),s._v(" "),e("h4",{attrs:{id:"配置-yum-的-kubernetes-repo-的阿里云源"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置-yum-的-kubernetes-repo-的阿里云源"}},[s._v("#")]),s._v(" 配置 yum 的 kubernetes.repo 的阿里云源")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v("EOF "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/yum.repos.d/kubernetes.repo\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kubernetes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Kubernetes\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("baseurl")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("enabled")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gpgcheck")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("repo_gpgcheck")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gpgkey")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("h4",{attrs:{id:"安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y kubectl\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"minikube-的安装配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#minikube-的安装配置"}},[s._v("#")]),s._v(" Minikube 的安装配置")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -Lo minikube http://kubernetes.oss-cn-hangzhou.aliyuncs.com/minikube/releases/v1.3.1/minikube-linux-amd64\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x minikube\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" minikube /usr/local/bin/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("关于 Minikube 的版本")]),s._v(" "),e("p",[s._v("我也不知道 Minikube 的版本在哪看, 反正 v1.3.1 没啥问题.")])]),s._v(" "),e("h3",{attrs:{id:"minikube-的启动与关闭"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#minikube-的启动与关闭"}},[s._v("#")]),s._v(" Minikube 的启动与关闭")]),s._v(" "),e("h4",{attrs:{id:"启动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[s._v("#")]),s._v(" 启动")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("minikube start --registry-mirror"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://registry.docker-cn.com --vm-driver"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("none --image-repository"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("registry.cn-hangzhou.aliyuncs.com/google_containers\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[e("code",[s._v("registry-mirror")]),e("br"),s._v("\n设定拉取 Docker 镜像的仓库.")]),s._v(" "),e("li",[e("code",[s._v("vm-driver=none")]),e("br"),s._v("\n由于是在虚拟机中启动 Minikube, 所以 "),e("code",[s._v("vm-driver")]),s._v(" 填写为 "),e("code",[s._v("none")])]),s._v(" "),e("li",[e("code",[s._v("image-repository")]),e("br"),s._v("\n设定拉取 Kubernetes 所需镜像的仓库.")])]),s._v(" "),e("h4",{attrs:{id:"关闭"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#关闭"}},[s._v("#")]),s._v(" 关闭")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("minikube stop\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"minikube-dashboard"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#minikube-dashboard"}},[s._v("#")]),s._v(" Minikube Dashboard")]),s._v(" "),e("p",[s._v("Minikube 仪表盘.")]),s._v(" "),e("p",[s._v("大部分的文章, 包括官方文档, 都提到了指令 "),e("code",[s._v("minikube dashboard")]),s._v(" 来启动一个能够使用浏览器访问的 GUI Kubernetes 管理界面. 使用这个指令时, 它会想办法启动操作系统中已经安装的浏览器, 但是由于我们的 CentOS 是最小化安装, 不可能有浏览器, 只能在虚拟机外部启动宿主机的浏览器.")]),s._v(" "),e("p",[s._v("一番操作后, 可以使用下方的指令:")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("kubectl proxy --address"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0.0.0.0'")]),s._v(" --disable-filter"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("然后宿主机浏览器访问")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以先用 ip addr 获取虚拟机 IP")]),s._v("\nhttp://"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("我们的虚拟机 IP"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":8001/api/v1/namespaces/kube-system/services/http:kubernetes-dashboard:/proxy/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[s._v("URL IP 后面一段是什么?")]),s._v(" "),e("p",[s._v("我们可以尝试一下 "),e("code",[s._v("minikube dashboard --url")]),s._v(" 看看都输出了什么. 本质上, dashboard 是一个服务, 这个指令可以获取服务对外的 url.")])]),s._v(" "),e("h2",{attrs:{id:"清除-minikube-的数据"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#清除-minikube-的数据"}},[s._v("#")]),s._v(" 清除 Minikube 的数据")]),s._v(" "),e("p",[s._v("如果感觉 Minikube 安装的不合适或是不正确就可以按照下方指令操作:")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("minikube delete\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf  ~/.minikube\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])])])}),[],!1,null,null,null);a.default=r.exports}}]);