(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{287:function(t,e,a){"use strict";a.r(e);var s=a(0),r=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"virtual-private-network-lab"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#virtual-private-network-lab"}},[t._v("#")]),t._v(" Virtual Private Network Lab")]),t._v(" "),a("h2",{attrs:{id:"pre-experiment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pre-experiment"}},[t._v("#")]),t._v(" Pre-Experiment")]),t._v(" "),a("h3",{attrs:{id:"修改端口-拦截-vpn"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改端口-拦截-vpn"}},[t._v("#")]),t._v(" 修改端口, 拦截 VPN")]),t._v(" "),a("p",[t._v("Wireshark 通过端口来判断通信方式, VPN 并没有一个标准的端口. 那就需要通知 Wireshark. 修改 Wireshark 的配置.")]),t._v(" "),a("h3",{attrs:{id:"解密加密通信"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解密加密通信"}},[t._v("#")]),t._v(" 解密加密通信")]),t._v(" "),a("p",[t._v("但是 Wireshark 现在并不能解密加密通信, 我们需要做到这一点. 将服务器的私钥提供给 Wireshark. 参考文档.")]),t._v(" "),a("h3",{attrs:{id:"获取主机-ip-地址"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取主机-ip-地址"}},[t._v("#")]),t._v(" 获取主机 IP 地址")]),t._v(" "),a("p",[t._v("从 Hostname 中获取 IP 地址. 使用 "),a("code",[t._v("getaddrindo()")]),t._v(" 方法. 参考文档代码")]),t._v(" "),a("h3",{attrs:{id:"获取-shadow-file-中的用户信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取-shadow-file-中的用户信息"}},[t._v("#")]),t._v(" 获取 shadow file 中的用户信息")]),t._v(" "),a("p",[t._v("文档中提到 "),a("code",[t._v("crypt")]),t._v(" 和 "),a("code",[t._v("crypto")]),t._v(" 两个东西?")]),t._v(" "),a("h3",{attrs:{id:"利用-pipe-进行父子进程间通信"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#利用-pipe-进行父子进程间通信"}},[t._v("#")]),t._v(" 利用 pipe 进行父子进程间通信")]),t._v(" "),a("p",[t._v("pipe 有两头, 连接父子, 支持双工通信, 但是我们只需要父发子听即可, 故关闭父端的 fd[0]. 仍有代码")]),t._v(" "),a("h3",{attrs:{id:"使用-select-监控多个输入接口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-select-监控多个输入接口"}},[t._v("#")]),t._v(" 使用 select 监控多个输入接口")]),t._v(" "),a("p",[t._v("所有的各类型接口都将以 file descriptor 的形式被展现. 使用 "),a("code",[t._v("select()")]),t._v(" 机制来同时监控多个输入接口.")]),t._v(" "),a("h3",{attrs:{id:"在我们的-vpn-中使用-telnet"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在我们的-vpn-中使用-telnet"}},[t._v("#")]),t._v(" 在我们的 VPN 中使用 telnet")]),t._v(" "),a("p",[t._v("telnet 常用于 Web 远程登录.")]),t._v(" "),a("h3",{attrs:{id:"minivpn-c-s-之间的通信流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#minivpn-c-s-之间的通信流程"}},[t._v("#")]),t._v(" MiniVPN C/S 之间的通信流程")]),t._v(" "),a("p",[t._v("VPN Tunnel 是什么.")]),t._v(" "),a("h2",{attrs:{id:"t1-vm-setup"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t1-vm-setup"}},[t._v("#")]),t._v(" T1 VM Setup")]),t._v(" "),a("p",[t._v("设置 VM. 固定 IP. 这个操作可能不影响?")]),t._v(" "),a("p",[t._v("如果 VM 使用了 Internal Network 模式, DHCP 就会被用上, 所以 VM 必须被静态配置.")]),t._v(" "),a("p",[t._v("Wired Connection 的数量:"),a("br"),t._v("\nHostV 只有一个连接;"),a("br"),t._v("\nVPN Server 可以看到两个;")]),t._v(" "),a("p",[t._v("针对 VPN Server? 选择对应 Internal Network 的 adapter. 可以尝试检查 Mac 地址.")]),t._v(" "),a("h2",{attrs:{id:"t2-creating-a-vpn-tunnel-using-tun-tap"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t2-creating-a-vpn-tunnel-using-tun-tap"}},[t._v("#")]),t._v(" T2 Creating a VPN Tunnel using TUN/TAP")]),t._v(" "),a("p",[t._v("TUN 与 TAP 是 VPN 的 kernel 驱动.")]),t._v(" "),a("p",[t._v("TAP 模拟 Ethernet 驱动. layer-2 packets?")]),t._v(" "),a("p",[t._v("TUN 模拟 network layer 驱动. layer-3 packets?")]),t._v(" "),a("p",[t._v("会有一个在用户空间的程序会与 TUN/TAP 对接.")]),t._v(" "),a("p",[t._v("看样子应该有两台设备: VPN Client 和 VPN Server. 两份程序: vpnclient 和 vpnserver. 这两份文件分贝对应 VPN tunnel 的两头. 在 VPN tunnel 中, 实验使用 UDP 通信.")]),t._v(" "),a("h3",{attrs:{id:"t2-1-run-vpn-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t2-1-run-vpn-server"}},[t._v("#")]),t._v(" T2.1 Run VPN Server")]),t._v(" "),a("p",[t._v("首先运行 VPN Server program. 运行完毕之后, 一个虚拟的 TUN 网络接口将被生成. 使用 "),a("code",[t._v("ifconfig -a")]),t._v(" 来查看. 完事配置此接口.")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("$ ./vpnserver\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ifconfig")]),t._v(" tun0 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".53.1/24 up\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[t._v("这里提到的 "),a("code",[t._v("192.168.53.1")]),t._v(" IP 具体是什么? 就是一个具体的值还是什么?")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("$ sysctl net.ipv4.ip_forward"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h3",{attrs:{id:"t2-2-run-vpn-client"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t2-2-run-vpn-client"}},[t._v("#")]),t._v(" T2.2 Run VPN Client")]),t._v(" "),a("p",[t._v("运行 VPN Client 程序搞事情.")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("$ ./vpnclient "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.0")]),t._v(".2.8\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ifconfig")]),t._v(" tun0 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".53.5/24 up\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("h3",{attrs:{id:"t2-3-set-up-routing-on-client-and-server-vms"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t2-3-set-up-routing-on-client-and-server-vms"}},[t._v("#")]),t._v(" T2.3 Set Up Routing on Client and Server VMs")]),t._v(" "),a("p",[t._v("设置 CS 之间的路由?")]),t._v(" "),a("p",[t._v("在客户机重定向所有的信息到 "),a("code",[t._v("192.168.60.0")])]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("$ route "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" -net "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.20")]),t._v(".30.0/24 eth0\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("我们需要对 CS 设备进行设置, 全部转到 "),a("code",[t._v("192.168.53.0/24")])]),t._v(" "),a("p",[t._v("这一步貌似可以不用做, 如果上面的步骤没有问题的话.")]),t._v(" "),a("h3",{attrs:{id:"t2-4-set-up-routing-on-host-v"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t2-4-set-up-routing-on-host-v"}},[t._v("#")]),t._v(" T2.4 Set Up Routing on Host V")]),t._v(" "),a("p",[t._v("设置 HostV 的路由.")]),t._v(" "),a("h3",{attrs:{id:"t2-5-test-the-vpn-tunnel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t2-5-test-the-vpn-tunnel"}},[t._v("#")]),t._v(" T2.5 Test the VPN Tunnel")]),t._v(" "),a("p",[t._v("测试这个 Tunnel. 在主机 U 上:")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".60.101\n$ telnet "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".60.101\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("h3",{attrs:{id:"t2-6-tunnel-breaking-test"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t2-6-tunnel-breaking-test"}},[t._v("#")]),t._v(" T2.6 Tunnel-Breaking Test")]),t._v(" "),a("h2",{attrs:{id:"t3-encrypting-the-tunnel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t3-encrypting-the-tunnel"}},[t._v("#")]),t._v(" T3 Encrypting the Tunnel")]),t._v(" "),a("h2",{attrs:{id:"t4-authenticating-the-vpn-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t4-authenticating-the-vpn-server"}},[t._v("#")]),t._v(" T4 Authenticating the VPN Server")]),t._v(" "),a("h2",{attrs:{id:"t5-authenticating-the-vpn-client"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t5-authenticating-the-vpn-client"}},[t._v("#")]),t._v(" T5 Authenticating the VPN Client")]),t._v(" "),a("h2",{attrs:{id:"t6-supporting-multiple-clients"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t6-supporting-multiple-clients"}},[t._v("#")]),t._v(" T6 Supporting Multiple Clients")])])}),[],!1,null,null,null);e.default=r.exports}}]);