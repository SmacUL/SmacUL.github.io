(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{205:function(a,s,e){"use strict";e.r(s);var t=e(0),n=Object(t.a)({},(function(){var a=this,s=a.$createElement,e=a._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"remote-dns-cache-poisoning-attack-lab"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#remote-dns-cache-poisoning-attack-lab"}},[a._v("#")]),a._v(" Remote DNS Cache Poisoning Attack Lab")]),a._v(" "),e("h2",{attrs:{id:"pre-experiment"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pre-experiment"}},[a._v("#")]),a._v(" Pre-Experiment")]),a._v(" "),e("p",[a._v("我们需要三台虚拟机, 一台作为 DNS 服务器, 一台为攻击者, 一台为受害者.")]),a._v(" "),e("ul",[e("li",[a._v("DNS 服务器: 10.0.2.16")]),a._v(" "),e("li",[a._v("攻击者 00 机: 10.0.2.14")]),a._v(" "),e("li",[a._v("受害者 01 机: 10.0.2.13")])]),a._v(" "),e("h3",{attrs:{id:"配置-dns-服务器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置-dns-服务器"}},[a._v("#")]),a._v(" 配置 DNS 服务器")]),a._v(" "),e("h4",{attrs:{id:"配置-bind9"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置-bind9"}},[a._v("#")]),a._v(" 配置 BIND9")]),a._v(" "),e("p",[a._v("BIND9 是一种 DNS 服务器软件, 虚拟机里已经装好了 BIND9. BIND9 的配置文件在 "),e("code",[a._v("/etc/bind/named.conf.")]),a._v(" 这个文件中包含了其他配置文件的路径:")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("div",{staticClass:"highlight-lines"},[e("div",{staticClass:"highlighted"},[a._v(" ")]),e("br"),e("br"),e("br")]),e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('include "/etc/bind/named.conf.options";\ninclude "/etc/bind/named.conf.local";\ninclude "/etc/bind/named.conf.default-zones";\n')])]),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("p",[a._v("我们需要修改的是 "),e("em",[a._v("named.conf.options")]),a._v(" 这个文件, 在这个文件中添加缓存内容文件的路径. 如果不指定, 默认缓存内容文件的路径为: "),e("code",[a._v("/var/cache/bind/named_dump.db")]),a._v(".")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("div",{staticClass:"highlight-lines"},[e("br"),e("br"),e("div",{staticClass:"highlighted"},[a._v(" ")]),e("br"),e("br"),e("br")]),e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('options {\n    directory "/var/cache/bind";\n    dump-file "/var/cache/bind/dump.db";\n    ...\n}\n')])]),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br")])]),e("p",[a._v("执行下方的两个指令:")]),a._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" rndc dumpdb -cache     "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 转存缓存到指定文件")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" rndc flush             "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 清空缓存文件")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("h4",{attrs:{id:"关闭-dnssec"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#关闭-dnssec"}},[a._v("#")]),a._v(" 关闭 DNSSEC")]),a._v(" "),e("p",[a._v("DNSSEC 应该是一种防止 DNS 服务器遭受 "),e("em",[a._v("spoofing attcks")]),a._v(" 的防御措施.")]),a._v(" "),e("p",[a._v("还是在上文的 "),e("em",[a._v("named.conf.options")]),a._v(" 文件, 找到并注释: "),e("code",[a._v("dnssec-validation auto;")]),a._v(",\n添加 "),e("code",[a._v("dnssec-enable no;")])]),a._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[a._v("这两个子操作的具体作用")]),a._v(" "),e("p",[a._v("?")])]),a._v(" "),e("h4",{attrs:{id:"固定端口"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#固定端口"}},[a._v("#")]),a._v(" 固定端口")]),a._v(" "),e("p",[a._v("在上文的 "),e("em",[a._v("named.conf.options")]),a._v(" 文件中的 options 中添加 "),e("code",[a._v("query-source port 33333;")]),a._v(" 设置所有 DNS 查询的 "),e("em",[a._v("source prot")]),a._v(" 为 33333.")]),a._v(" "),e("h4",{attrs:{id:"移除-example-com"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#移除-example-com"}},[a._v("#")]),a._v(" 移除 "),e("em",[a._v("example.com")])]),a._v(" "),e("h4",{attrs:{id:"重启-dns-服务器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#重启-dns-服务器"}},[a._v("#")]),a._v(" 重启 DNS 服务器.")]),a._v(" "),e("p",[a._v("有修改就重启.")]),a._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" bind9 restart\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h4",{attrs:{id:"检查启动是否成功"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#检查启动是否成功"}},[a._v("#")]),a._v(" 检查启动是否成功")]),a._v(" "),e("p",[a._v("可以检查一下 "),e("code",[a._v("/var/log/syslog")]),a._v(" 有没有提示服务 bind9 启动失败.")]),a._v(" "),e("h3",{attrs:{id:"配置用户虚拟机"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置用户虚拟机"}},[a._v("#")]),a._v(" 配置用户虚拟机")]),a._v(" "),e("h4",{attrs:{id:"配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[a._v("#")]),a._v(" 配置")]),a._v(" "),e("p",[a._v("设置用户虚拟机的本地 DNS 服务器为我们之前设置的那个. "),e("code",[a._v("/etc/resolv.conf")]),a._v(" 文件可以做到这个. 修改一下 "),e("code",[a._v("nameserver 10.0.2.16")]),a._v(".")]),a._v(" "),e("p",[a._v("但是 DHCP 会覆盖这个文件, 所以, 修改文件 "),e("code",[a._v("/etc/resolvconf/resolv.conf.d/head")]),a._v(", 添加 "),e("code",[a._v("nameserver 10.0.2.16")]),a._v(". 完事生效配置文件:")]),a._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" resolvconf -u\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h4",{attrs:{id:"测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[a._v("#")]),a._v(" 测试")]),a._v(" "),e("p",[a._v("使用 dig 指令, 可以看到:\n"),e("img",{attrs:{src:"/note/img/2020-02-09-09-42-18.png",alt:""}}),a._v("\n在 "),e("code",[a._v("SERVER")]),a._v(" 中我们可以看到 DNS 服务器的 IP (图中 .15 修正为 .16).")]),a._v(" "),e("p",[a._v("dig 命令是常用的域名查询工具，可以用来测试域名系统工作是否正常。")]),a._v(" "),e("h2",{attrs:{id:"t1-remote-cache-poisoning"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#t1-remote-cache-poisoning"}},[a._v("#")]),a._v(" T1 Remote Cache Poisoning")]),a._v(" "),e("p",[e("em",[a._v("Kaminsky attack")])]),a._v(" "),e("h3",{attrs:{id:"t1-1-spoofing-dns-request"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#t1-1-spoofing-dns-request"}},[a._v("#")]),a._v(" T1.1 Spoofing DNS request")]),a._v(" "),e("p",[a._v("伪装 DNS 请求.")]),a._v(" "),e("p",[e("a",{attrs:{href:"https://seedsecuritylabs.org/Labs_16.04/Networking/DNS_Remote/udp.c",target:"_blank",rel:"noopener noreferrer"}},[a._v("脚本 udp.c"),e("OutboundLink")],1)]),a._v(" "),e("h3",{attrs:{id:"t1-2-spoofing-dns-replies"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#t1-2-spoofing-dns-replies"}},[a._v("#")]),a._v(" T1.2 Spoofing DNS Replies")]),a._v(" "),e("p",[a._v("伪装 DNS 响应.")]),a._v(" "),e("h3",{attrs:{id:"t1-3-the-kaminsky-attack"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#t1-3-the-kaminsky-attack"}},[a._v("#")]),a._v(" T1.3 The Kaminsky Attack")]),a._v(" "),e("h2",{attrs:{id:"t2-result-verification"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#t2-result-verification"}},[a._v("#")]),a._v(" T2 Result Verification")]),a._v(" "),e("h3",{attrs:{id:"use-a-real-domain-name"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#use-a-real-domain-name"}},[a._v("#")]),a._v(" Use a Real Domain Name")]),a._v(" "),e("h3",{attrs:{id:"use-a-fake-domain-name"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#use-a-fake-domain-name"}},[a._v("#")]),a._v(" Use A Fake Domain Name")])])}),[],!1,null,null,null);s.default=n.exports}}]);