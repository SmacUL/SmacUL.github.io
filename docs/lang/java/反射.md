# 反射

反射是 Java 的特有概念, 简单来说就是允许程序在运行过程**获得**甚至**修改**类及类内部的相关信息. 

在最初学习 Java 的时候, 我认为反射是一个建设框架才需要学习的知识, 后来接触到了一些后端框架, 才慢慢意识到了解反射的重要性. 

## 为什么要有反射



面向对象编程应该努力做到只操纵基类的引用, 保证大部分代码尽可能少的了解对象的具体类型. 然后我们想想 Java 中的多态, 我们很多时候都不会在代码中明确说明 某个引用具体指引着哪个类的对象, 更多的只会写下基类的引用. 

那么问题来了, JVM 在执行类加载的时候, 如何知道某一个引用具体指向的是哪个类的对象? 又比如, 在泛型程序设计或者框架设计中, 如何创建一个更加通用的程序(使用 if 判断注入的对象通常是不明智的). 

## 反射的基本原理

### Java 代码的基本运行方式

> 在程序运行期间，Java 运行时系统始终为所有的对象维护一个被称为运行时的类型标识. 这个信息跟踪着每个对象所属的类. JVM 利用运行时类型信息选择相应的方法执行。

捋一捋上面这句话, 先只考虑最简单的情况, 一个类包括类构造器与类属性和类方法, 类构造器和类方法又包括方法签名和逻辑代码. 

#### 编写代码  
在使用的时候, 我们先从静态方法 `main()` 开始, 想办法创建对象, 以及这些对象对应的引用, 然后调用方法或者属性编写逻辑. 我们编写好的程序会被存放到硬盘(或者别的什么地方)上等待 JVM 的加载.

#### 编译
如果我们下达了执行命令, JVM 就会编译 `.java` 文件将其转为 `.class` 文件. 这个过程中, 代码内每一个我们创建的类都会拥有一个与自己同名的 `.class` 文件用来记录类的内部信息.

#### 加载
 这些文件被 JVM 加载后就会成为 `Class` 对象(属于 `Class` 类), 这些对象将包含类属性集合对象(`Field[]` 对象), 类构造器集合对象(`Constructor[]` 对象), 类方法集合对象(`Method[]` 对象). 

<!-- <div style="width=100%"> -->
<img src="/note/img/2019-12-09-16-34-53.png" style="zoom:30%; display: block; margin: 0 auto;" />
<!-- </div> -->

#### 总结
从上面可以看出, 一切的一切都指向了 `java.lang.Class` 类. 此外还有 `java.lang.reflect.Field`, `java.lang.reflect.Method`, `java.lang.reflect.Constructor`; 

### 简单地看一下与反射相关的包与 API

<!-- 
java 反射 为什么会有反射，反射的功能是什么，考虑类  方法 作用域 对象 静态内容 基本数据类型 集合数据类型 内部类 在反射下的表现，考虑访问权限对反射工作的影响，基础内容：范性，内部类，匿名为什么要 final ，加载顺序，类的储存，类的访问权限， -->
<!-- ## 反射的基本原理 -->


``` Java
package lang;

class Test {
    public void func() {
        System.out.println("hello this is func");
    }
}

public class ClassTest {
    public static void main(String[] args) throws 
        ClassNotFoundException, IllegalAccessException, InstantiationException 
    {
        Class testClass = Class.forName("lang.Test");
        Test tt = (Test)testClass.newInstance();
        tt.func();
    }
}
```
