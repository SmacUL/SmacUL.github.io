# 变量 作用域 垃圾回收 

## 基本类型与引用类型

下面的四个主题需要分别考虑 基本类型 和 引用类型 

- 基本类型: 按值访问;
- 引用类型: 按引用访问;

 

### 动态的属性

- 基本类型: 无法给一个基本类型添加变量;
- 引用类型: 为所欲为;

 

### 复制变量值

- 基本类型: 相互存储, 互不干扰;
- 引用类型: 多个引用会指向同一个对象;


### 传递参数

在 ECMAScript 中的函数参数传递都是 按值传递 

- 基本类型: 传递的是实际数据的副本;
- 引用类型: 传递的是对象地址的副本;

 
::: tip
可以认为这里的参数传递机制与 Java 一致;

可以吧 ECMAScript 函数的参数想象成局部变量;
:::


### 检测类型

- 基本类型: typeof ;
- 引用类型: instanceof ;

 

## 作用域

### 执行环境

执行环境定义了变量或函数有权访问的其他数据, 决定了它们各自的行为;

### 作用域链

保证 对执行环境有权访问的所有变量和函数 的 有序 访问; 

是一个树状结构;

::: tip
父环境无法通过作用域链向下(由父到子)访问到子环境中的变量;

子环境可以通过作用域链向上(由子到父)访问到父环境中的变量;

可以参考 Java 的内部类;
:::

 

非常有意思的一点: 

如果作用域链中存在多个同名的局部变量, 

JS 在使用 此变量名的变量 时就会启动变量查询机制, 

这个机制将会从当前的执行环境开始, 

沿着作用域链向上查找最近的声明了的同名变量; 

 

### 没有块级的作用域

意味着花括号不再具备对作用域的限制功能;

 

## 垃圾回收

 

垃圾回收机制的设计思想: 找出那些不再继续使用的变量, 然后释放其占用的内存;

JSGC 会定期执行这个操作, 当然部分情况下允许程序员自己来;

 

为了提高垃圾回收机制的效率, 可以在使用完某个对象之后, 将这个对象的引用设置为 NULL ;
 

### 标记清除(常见)

1. JSGC 在运行过程中给内存中的每个变量都加上标记; 
2. 在 环境中/被环境引用的变量 将被去除标记; 
3. JSGC 开始销毁那些仍有标记的变量;

 

### 引用计数

所谓的引用就是对象被引用的次数;

一个致命缺陷就是 循环引用 , 即:

 A 用 B , B 用 A 的情况;