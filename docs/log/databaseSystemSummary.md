# 数据库系统概论

# 绪论
## 数据库的四个基本概念
- 数据  
    数据是数据库存储的基本对象
- 数据库  
    数据库是长期存储在计算机内部、有组织的、可共享的大量数据集合
- 数据库管理系统  
    一种计算机基础软件
- 数据库系统
    数据库系统是由数据库、数据库管理系统、应用程序和数据库管理员组成的存储、管理、处理和维护数据的系统

## 数据库管理的三个阶段的比较
1. 人工管理阶段
2. 文件系统阶段
3. 数据库管理阶段

## 数据库系统的特点
- 数据结构化  
    数据库系统的主要特征，数据库系统和文件管理系统的本质区别  
    数据库面向整个企业或组织，数据内部和整体都是结构化的，数据之间有联系
- 数据冗余度低、共享性高、易于扩充
- 数据独立性高
    - 物理独立性
        应用程序和数据库中数据的物理存储是相互独立的
    - 逻辑独立性  
        应用程序和数据库中数据的逻辑结构是相互独立的
- 数据由数据库管理系统统一管理与控制
    - 数据安全性保护
        指保护数据以防止不合法使用造成的数据泄密和破坏
    - 数据完整性保护  
        指数据的正确性、有效性、相容性
    - 并发控制
    - 数据库恢复

## 数据模型
数据模型是对现实世界数据特征的抽象。数据模型是数据库系统和核心和基础。  

## 数据模型应满足三个方面的要求
- 能比较真实地模拟现实世界
- 容易被人理解
- 便于在计算机上实现

## 数据模型的组成要素
- 数据结构
    
- 数据操作
- 数据的完整性约束

## 数据模型的两大类
- 概念模型
    构建概念模型的一种方法：实体-联系方法（ER图）
- 逻辑模型和物理模型

## 信息世界中的基本概念
- 实体  
    客观存在并可相互区别
- 属性  
    实体所具有的某一特性
- 码  
    唯一表示实体的属性集
- 实体型  
    用实体名及其属性名集合来抽象和刻画同类实体
- 实体集  
    同一类型实体的集合
- 联系  
    包括实体内部的联系和实体之间的联系

<br>


# 关系数据库标准语言SQL

## SQL的特点
1. 综合统一
    - 数据结构单一  
    - 数据操作统一
3. 高度非过程化  
    使用SQL的时候不需要关注怎么做，只需要关注做什么
4. 面向集合的操作方式  
5. 以同一种语法结构提供多种使用方式  
    既可单独使用，也可以在其他高级语言中嵌入使用
6. 语言简洁，易学易用

    | SQL功能 | 动词 |
    | -- | -- |
    | 数据查询 | SELECT |
    | 数据定义 | CREATE DROP ALTER |
    | 数据操纵 | INSERT UPDATE DELETE |
    | 数据控制 | GRANT REVOKE |

    外模式：视图和部分基本表  
    模式：基本表  
    内模式：存储文件   

## 视图的作用
- 简化用户的操作
- 使用户能够以多种角度看待同一数据
- 对重构数据库提供了一定程度的逻辑独立性
- 能够对机密数据提供安全保护
- 适当利用视图可以更清晰地表达查询


<br>

# 数据库安全性

## 数据库安全性控制的方法
数据库安全性是为了防止恶意破坏和非法存取
- 用户身份鉴别
- 多层存取控制
- 审计
    把用户对数据库的所有操作自动记录下来写入审计日志中  
    - 用户级审计
    - 系统级审计
- 视图
- 数据加密

<br>

# 数据库完整性
数据库完整性是为了防止数据库中存在不合语义的数据  
- 数据的正确性  
    数据是符合现实世界语义的
- 数据的相容性  
    数据库同一对象在不同关系表中的数据是符合逻辑的

区别于关系的完整性约束条件
- 实体完整性
- 参照完整性
- 用户自定义的完整性

为了保证数据库的完整性，数据库系统需要做到：
- 提供定义完整性约束条件的机制
- 提供完整性检查的方法
- 进行违约处理

## 断言

## 触发器
用户定义在关系表上的一类由事件驱动的特殊过程  
触发器也叫事件-条件-动作规则


# 关系数据理论
## 函数依赖


<br>

# 数据库设计

## ER图冲突
- 属性冲突
    参与数据库设计的各部门协商解决
    - 属性域冲突
    - 属性取值单位冲突
- 命名冲突
    讨论协商解决
    - 同名异意
    - 异名同意
- 结构冲突
    - 同一对象在不同应用中有不同的抽象
    - 同一实体在不同子系统的ER图中所包含的属性个数个属性的顺序不相同
    - 实体间的联系在不同的ER图中为不同的类型

# 数据库恢复技术

## 事务
事务是用户定义的一个数据库操作序列，是一个不可分割的工作对象  
一个程序包含多个事务

## 事务的ACID特征
- 原子性
    不可分割
- 一致性
    数据库状态由一个一致状态转到另一个一致状态  
- 隔离性  
    并发执行的各个事务间互不干扰
- 持续性(永久性)
    事务一旦提交，它对数据库数据的改变就是永久的

## 数据库故障分类
- 事物内部的故障

- 系统故障  
    造成系统停止运转的任何故障，使得系统需要重新启动
- 介质故障  
    存储设备故障
- 计算机病毒

## 恢复的实现技术
- 数据转储
    - 静态转储
    - 动态转储
- 登记日志文件

<br>

# 并发控制

## 并发控制概述
事务是并发控制的基本单位  
- 丢失修改
- 不可重复读
- 读脏数据

## 封锁
事务在对某个数据对象进行操作之前，先向系统申请，对其加锁  
- 排他锁（写锁）
- 共享锁（读锁）

## 封锁协议
- 一级封锁协议  
    事务在修改数据之前，必须对该数据加锁,修改结束之后释放
- 二级封锁协议  
    在一级封锁的基础上，增加：当事务读取数据时，必须对数据加锁，读完之后释放
- 三级封锁协议  
    在一级封锁的基础上，增加：当事务读取数据时，必须对数据加锁，**事务结束**之后释放

## 活锁
某个事件可能出现永远等待的情况  
避免方法：先来先服务

## 死锁
各个事务在相互等待其他事务释放资源，导致所有事务永久的等待


